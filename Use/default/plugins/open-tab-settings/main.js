/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var m=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var C=(o,i)=>{for(var e in i)m(o,e,{get:i[e],enumerable:!0})},L=(o,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let n of E(i))!A.call(o,n)&&n!==e&&m(o,n,{get:()=>i[n],enumerable:!(t=v(i,n))||t.enumerable});return o};var G=o=>L(m({},"__esModule",{value:!0}),o);var V={};C(V,{default:()=>w});module.exports=G(V);var l=require("obsidian");function h(o,i){let e=Object.keys(i).map(t=>W(o,t,i[t]));return e.length===1?e[0]:function(){e.forEach(t=>t())}}function W(o,i,e){let t=o[i],n=o.hasOwnProperty(i),a=n?t:function(){return Object.getPrototypeOf(o)[i].apply(this,arguments)},s=e(a);return t&&Object.setPrototypeOf(s,t),Object.setPrototypeOf(p,s),o[i]=p,u;function p(...c){return s===a&&o[i]===p&&u(),s.apply(this,c)}function u(){o[i]===p&&(n?o[i]=a:delete o[i]),s!==a&&(s=a,Object.setPrototypeOf(p,t||Function))}}var d=require("obsidian"),M={"after-active":"After active tab","after-pinned":"After pinned tabs",beginning:"At beginning",end:"At end"},_={same:"In same tab group",opposite:"In opposite tab group",first:"In first tab group",last:"In last tab group"},y={openInNewTab:!0,deduplicateTabs:!0,openInSameTabOnModClick:!1,newTabPlacement:"after-active",newTabTabGroupPlacement:"same"},T=class extends d.PluginSettingTab{constructor(i,e){super(i,e),this.plugin=e}display(){this.containerEl.empty();let i=()=>{e.settingEl.setCssStyles({opacity:this.plugin.settings.openInNewTab?"":"50%"}),e.setDisabled(!this.plugin.settings.openInNewTab)};new d.Setting(this.containerEl).setName("Always open in new tab").setDesc("Open files in a new tab by default.").addToggle(t=>t.setValue(this.plugin.settings.openInNewTab).onChange(async n=>{await this.plugin.updateSettings({openInNewTab:n}),i()})),new d.Setting(this.containerEl).setName("Prevent duplicate tabs").setDesc("If a tab is already open, switch to it instead of re-opening it.").addToggle(t=>t.setValue(this.plugin.settings.deduplicateTabs).onChange(async n=>{await this.plugin.updateSettings({deduplicateTabs:n})}));let e=new d.Setting(this.containerEl).setName("Open in same tab on ctrl/middle click").setDesc('When "Always open in new tab" is enabled, open in same tab when using Ctrl click or middle click.').addToggle(t=>t.setValue(this.plugin.settings.openInSameTabOnModClick).onChange(async n=>{await this.plugin.updateSettings({openInSameTabOnModClick:n})}));new d.Setting(this.containerEl).setName("Focus explicit new tabs").setDesc("Immediately switch to new tabs opened via middle or ctrl click instead of opening them in the background. New tabs created by regular click will always focus regardless.").addToggle(t=>t.setValue(this.app.vault.getConfig("focusNewTab")).onChange(async n=>{this.app.vault.setConfig("focusNewTab",n)})),new d.Setting(this.containerEl).setName("New tab placement").setDesc("Place new tabs...").addDropdown(t=>t.addOptions(M).setValue(this.plugin.settings.newTabPlacement).onChange(async n=>{await this.plugin.updateSettings({newTabPlacement:n})})),new d.Setting(this.containerEl).setName("New tab tab group placement").setDesc("When the workspace is split, prefer to open new tabs...").addDropdown(t=>t.addOptions(_).setValue(this.plugin.settings.newTabTabGroupPlacement).onChange(async n=>{await this.plugin.updateSettings({newTabTabGroupPlacement:n})})),i()}};var D={md:["excalidraw","kanban"]};function f(o){return["empty","home-tab-view"].includes(o.view.getViewType())}function S(o){let i=o.getRoot();return i instanceof l.WorkspaceRoot||i instanceof l.WorkspaceFloating}var w=class extends l.Plugin{constructor(){super(...arguments);this.settings={...y}}async onload(){await this.loadSettings(),this.addSettingTab(new T(this.app,this)),this.registerMonkeyPatches(),this.registerEvent(this.app.workspace.on("file-menu",(t,n,a,s)=>{n instanceof l.TFile&&t.addItem(p=>{p.setSection("open"),p.setIcon("file-minus"),p.setTitle("Open in same tab"),p.onClick(async()=>{await this.app.workspace.getLeaf("same").openFile(n)})})}));let e=[["openInNewTab","always open in new tab"],["deduplicateTabs","prevent duplicate tabs"]];for(let[t,n]of e){let a=t.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`);this.addCommand({id:`toggle-${a}`,name:`Toggle ${n}`,callback:async()=>{await this.updateSettings({[t]:!this.settings[t]})}}),this.addCommand({id:`enable-${a}`,name:`Enable ${n}`,callback:async()=>{await this.updateSettings({[t]:!0})}}),this.addCommand({id:`disable-${a}`,name:`Disable ${n}`,callback:async()=>{await this.updateSettings({[t]:!1})}})}}registerMonkeyPatches(){let e=this,t=this.app.workspace.getUnpinnedLeaf;this.register(h(l.Workspace.prototype,{getLeaf(n){return function(a,...s){var g;let p=(g=e.app.workspace.getActiveViewOfType(l.View))==null?void 0:g.leaf,u=e.settings.openInNewTab&&!a,c;a==!0?(c="tab",a="tab"):e.settings.openInNewTab?(c=a||"default",a=a||"tab"):(c=a||"default",a=a||"same");let r;return a=="tab"?(r=e.getNewLeaf(),(e.app.vault.getConfig("focusNewTab")||u)&&e.app.workspace.setActiveLeaf(r)):a=="same"?e.settings.openInNewTab&&t?r=t.call(this):r=n.call(this,!1,...s):r=n.call(this,a,...s),r.openTabSettingsLastOpenType=c,r.openTabSettingsOpenedFrom=p==null?void 0:p.id,r}},getUnpinnedLeaf(n){return function(...a){return e.settings.openInNewTab?e.app.workspace.getLeaf("tab"):n.call(this,...a)}}})),this.register(h(l.WorkspaceLeaf.prototype,{openFile(n){return async function(a,s,...p){var N,O;let u,c,r=e.findMatchingLeaves(a),g=this.openTabSettingsLastOpenType,P=this.openTabSettingsOpenedFrom,k=!S(this)||f(this)&&!["same","tab","default"].includes(g!=null?g:"unknown"),I=f(this)&&!!((N=s==null?void 0:s.eState)!=null&&N.subpath)&&r.some(b=>b.id==P);if(e.settings.openInNewTab&&I&&!k&&g=="default"?c=r.find(b=>b.id==P):e.settings.deduplicateTabs&&!k&&r.length>0&&!r.includes(this)&&(c=r[0]),c)if(c.view.getViewType()=="kanban")this.app.workspace.setActiveLeaf(r[0]),u=void 0;else{let b=(O=e.app.workspace.getActiveViewOfType(l.View))==null?void 0:O.leaf;u=await n.call(r[0],a,{...s,active:!!(s!=null&&s.active)||b==this},...p)}else u=await n.call(this,a,s,...p);return f(this)&&this.parent.children.length>1&&this.detach(),u}}})),this.register(h(l.Keymap,{isModEvent(n){return function(...a){let s=n.call(this,...a);return e.settings.openInNewTab&&e.settings.openInSameTabOnModClick&&s=="tab"&&(s="same"),s}}}))}async loadSettings(){var t;let e=(t=await this.loadData())!=null?t:{};e.openNewTabsInOtherTabGroup!==void 0&&(e.newTabTabGroupPlacement=e.openNewTabsInOtherTabGroup?"last":"same",delete e.openNewTabsInOtherTabGroup),this.settings=Object.assign({},y,e),Object.keys(e).length==0&&(this.app.vault.setConfig("focusNewTab",!1),await this.updateSettings({}))}async updateSettings(e){Object.assign(this.settings,e),await this.saveData(this.settings)}findMatchingLeaves(e){let t=[];return this.app.workspace.iterateAllLeaves(n=>{var u,c,r;let a=((c=(u=n.getViewState())==null?void 0:u.state)==null?void 0:c.file)==e.path,s=n.view.getViewType(),p=this.app.viewRegistry.getTypeByExtension(e.extension)==s||((r=D[e.extension])==null?void 0:r.includes(s));S(n)&&a&&p&&t.push(n)}),t}getAllTabGroups(e){let t=new Set;return this.app.workspace.iterateAllLeaves(n=>{n.getRoot()==e&&t.add(n.parent)}),[...t]}getNewLeaf(){let e=this.app.workspace.getMostRecentLeaf();if(!e)throw new Error("No tab group found.");let t=e.parent,n=t.children.indexOf(e);if(f(e))return e;let a,s;if(this.settings.newTabTabGroupPlacement!="same"&&!l.Platform.isPhone){let c=this.getAllTabGroups(e.getRoot()),r=c.filter(g=>g!==t).at(-1);this.settings.newTabTabGroupPlacement=="opposite"&&r?a=r:this.settings.newTabTabGroupPlacement=="first"&&c.at(0)?a=c[0]:this.settings.newTabTabGroupPlacement=="last"&&c.at(-1)&&(a=c.at(-1))}if(a||(a=t),a==t)if(this.settings.newTabPlacement=="after-pinned"){let c=a.children.findLastIndex(r=>r.pinned);s=c>=0?c+1:n+1}else this.settings.newTabPlacement=="beginning"?s=0:this.settings.newTabPlacement=="end"?s=t.children.length:s=n+1;else this.settings.newTabPlacement=="beginning"?s=0:s=t.children.length;let p,u=a.children[Math.min(s,a.children.length-1)];return f(u)?p=u:(p=new l.WorkspaceLeaf(this.app),a.insertChild(s,p)),p}};

/* nosourcemap */